<!doctype html>
<html>
<head>
    <title>物联网资源中心</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"/>
    <meta name="keywords" content="物联网资源中心"/>
    <meta name="description" content="物联网资源中心"/>
    <meta name="author" content="物联网资源中心" />
    <meta name="site" content="https://blog.52itstyle.vip" />
    <link rel="stylesheet" th:href="@{/iview/styles/iview.css}">
    <link rel="icon" type="image/png" href="assets/i/favicon.png">
    <link rel="apple-touch-icon-precomposed" href="assets/i/app-icon72x72@2x.png">
    <meta name="apple-mobile-web-app-title" content="Amaze UI" />
    <link rel="stylesheet" href="assets/css/amazeui.min.css" />
    <link rel="stylesheet" href="assets/css/admin.css">
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" href="layui/css/layui.css"  media="all">
</head>

<body data-type="index">
    <header class="am-topbar am-topbar-inverse admin-header">
        <div class="am-topbar-brand">
            <a href="javascript:;" class="tpl-logo" style="width: 80px;">
                <img src="img/zyzx.png" alt="" style="height: 70px;width: 70px; ">
            </a>
            物联网资源中心
        </div>
        <!--<div class="am-icon-list tpl-header-nav-hover-ico am-fl am-margin-right"></div>-->
        <!--<button class="am-topbar-btn am-topbar-toggle am-btn am-btn-sm am-btn-success am-show-sm-only" data-am-collapse="{target: '#topbar-collapse'}"><span class="am-sr-only">导航切换</span> <span class="am-icon-bars"></span></button>-->
        <div class="am-collapse am-topbar-collapse" id="topbar-collapse">
            <ul id="app" class="am-nav am-nav-pills am-topbar-nav am-topbar-right admin-header-list tpl-header-list">
                <li class="am-dropdown" data-am-dropdown data-am-dropdown-toggle>
                    <a class="am-dropdown-toggle tpl-header-list-link" href="javascript:;">
                        <span class="tpl-header-list-user-nick">青阳廿四</span><span class="tpl-header-list-user-ico"> <img src="assets/img/user01.png"></span>
                    </a>
                    <ul class="am-dropdown-content" v-cloak >
                        <li><a href="#"><span class="am-icon-bell-o"></span> 资料</a></li>
                        <li><a href="#"><span class="am-icon-cog"></span> 设置</a></li>
                        <li><a href="#" @click="logout"><span class="am-icon-power-off"></span> 退出</a></li>
                    </ul>
                </li>
                <!--<li><a href="#" @click="logout" class="tpl-header-list-link"><span class="am-icon-sign-out tpl-header-list-ico-out-size"></span></a></li>-->
            </ul>
        </div>
    </header>
    <div class="tpl-page-container tpl-page-header-fixed">
        <div class="tpl-left-nav tpl-left-nav-hover">
            <div class="tpl-left-nav-list">
                <ul class="tpl-left-nav-menu">
                    <li class="tpl-left-nav-item">
                        <a href="javascript:;" class="nav-link active">
                            <!--<i class="am-icon-home"></i>-->
                            <span>文件目录</span>
                        </a>
                    </li>
                    <li class="tpl-left-nav-item" onclick="changeRootPath('D:/cloudFile_51Module');">
                        <a href="javascript:;" class="nav-link">
                            <i class="am-form-file"></i>
                            <span>51单片机源码</span>
                            <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                        </a>
                    </li>
                    <li class="tpl-left-nav-item" onclick="changeRootPath('D:/cloudFile_stm32Module');">
                        <a href="javascript:;" class="nav-link">
                            <i class="am-form-file"></i>
                            <span>stm32源码</span>
                            <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                        </a>
                    </li>
                    <li class="tpl-left-nav-item" onclick="changeRootPath('D:/cloudFile_raspberry_Pi');">
                        <a href="javascript:;" class="nav-link">
                            <i class="am-form-file"></i>
                            <span>树莓派源码</span>
                            <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                        </a>
                    </li>
                    <li class="tpl-left-nav-item" onclick="changeRootPath('D:/cloudFile_other');">
                        <a href="javascript:;" class="nav-link">
                            <i class="am-form-file"></i>
                            <span>其它源码</span>
                            <i class="am-icon-star tpl-left-nav-content-ico am-fr am-margin-right"></i>
                        </a>
                    </li>
                    <li class="tpl-left-nav-item" >
                        <a href="javascript:;" class="nav-link tpl-left-nav-link-list">
                            <!--<i class="am-icon-wpforms"></i>-->
                            <span>芯片源码</span>
                            <i class="am-icon-angle-right tpl-left-nav-more-ico am-fr am-margin-right tpl-left-nav-more-ico-rotate"></i>
                        </a>
                        <ul class="tpl-left-nav-sub-menu" style="display: block;" id="chip">

                        </ul>

                    </li>
                </ul>
            </div>
        </div>
        <div class="tpl-content-wrapper back_dic" id="back_catalog">../ 返回上一级目录</div>
        <div class="tpl-content-wrapper" id="fileRootPath"></div>
        <div id="menu">
            <div class="menu" onmouseover="this.className='menu_gray'" onmouseleave="this.className='menu'">复制文件地址</div>
            <div class="menu" onclick="downloadFile()" onmouseover="this.className='menu_gray'" onmouseleave="this.className='menu'">下载</div>
            <div class="menu" onmouseover="this.className='menu_gray'" onmouseleave="this.className='menu'">删除</div>
            <div class="menu" onmouseover="this.className='menu_gray'" onmouseleave="this.className='menu'">更多</div>
        </div>
        <style>
            #back_catalog{
                margin-left: 255px;
                padding-left: 0px;
            }
            #fileRootPath{
                padding-top: 5px;
            }
            .fileIcon{
                width: 10%;
                /*height: 50px;*/
                background: #f2f6f9;
                display: inline-block;
                margin: 2px;
            }
            .fileImg{
                width: 100%;
            }
            .back_dic{
                background-color: #f2f6f9;
            }
            .fileText{
                text-align: center;
                width: 100%;
                height: 1.4em;
                margin-top: -0.8em;
                font-size: 0.9em;
                overflow: hidden;
            }
            #menu{
                width: 0; /*设置为0 隐藏自定义菜单*/
                height: 100px;
                overflow: hidden; /*隐藏溢出的元素*/
                box-shadow: 0 1px 1px #888,1px 0 1px #ccc;
                position: fixed; /*自定义菜单相对与body元素进行定位*/
            }
            .menu_gray{
                width: 130px;
                height: 25px;
                line-height: 25px;
                padding: 0 10px;
                background-color: gray;
            }
            .menu{
                width: 130px;
                height: 25px;
                line-height: 25px;
                padding: 0 10px;
            }
        </style>
    <script src="layui/layui.js" charset="utf-8"></script>
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/amazeui.min.js"></script>
    <script src="assets/js/iscroll.js"></script>
    <script src="assets/js/app.js"></script>
    <script th:src="@{libs/vue.min.js}"></script>
    <script th:src="@{/iview/iview.min.js}" type="text/javascript"></script>
    <script type="text/javascript">
        var layer = layui.layer;
        var that_vm = null;
        $(function () {
            var vm = new Vue({
                el: '#app',
                data:{
                    path:[],
                    pathData:{},
                    rootPath:""
                },
                methods: {
                    loadFilePath:function (rootPathParam) {
                        $.ajax({
                            url:"file/FileList",
                            method:"GET",
                            datat:"json",
                            data:{
                                rootPath:rootPathParam
                            },
                            success:function (response) {
                                // console.log(response);
                                vm.pathData = response.data;
                                vm.path = [];
                                vm.displayFile();
                            },
                            fail:function (error) {
                                self.$Notice.warning({
                                    title: '友情提醒',
                                    desc: '拉取文件列表信息失败'
                                });
                            }
                        })


                    },
                    displayFile: function(){
                        let data = this.pathData;
                        for(let i = 0;i<this.path.length;i++){
                            data = data[this.path[i]].list;
                        }
                        let div = document.getElementById("fileRootPath");
                        for (let i = 0 ;i<data.length;i++){
                            let div1 = document.createElement("div");
                            let div2 = document.createElement("div");
                            let img = document.createElement("img");
                            div1.classList.add("fileIcon");
                            div1.id = data[i].name;
                            div2.id = data[i].name;
                            img.id = data[i].name;
                            div1.data = data[i].type;
                            div2.data = data[i].type;
                            img.data = data[i].type;
                            div1.oncontextmenu = (e)=>{
                                e.preventDefault();
                                var menu=document.querySelector("#menu");
                                menu.style.left=e.clientX+'px';
                                menu.style.top=e.clientY+'px';
                                menu.style.width='125px';
                                // console.log(e.target.data);
                                // console.log(e.target.id);
                                menu.data = {name:e.target.id,type:e.target.data};
                            };
                            div1.addEventListener("click",()=>{vm.fileClick(i,data[i].type)});
                            div2.classList.add("fileText");
                            div2.innerText = data[i].name;
                            img.classList.add("fileImg");
                            if (data[i].type==0)
                                img.src = "img/fjj.png";
                            else
                                img.src = "img/fj.png";
                            div1.appendChild(img);
                            div1.appendChild(div2);
                            div.appendChild(div1);
                        }
                    },
                    // changeRootPath:function(path){
                    //     document.getElementById("fileRootPath").innerHTML = "";
                    //      vm.loadFilePath(path);
                    //  },
                    fileClick:function(index,type){
                        if (type == 1) return ;
                        document.getElementById("fileRootPath").innerHTML = "";
                        vm.path.push(index);
                        vm.displayFile();
                    },
                    back_catalog:function () {
                        if (vm.path.length<=0) return;
                        document.getElementById("fileRootPath").innerHTML = "";
                        vm.path.splice(vm.path.length-1,1);
                        vm.displayFile();
                    },
                    logout: function (event) {
                        var self = this;
                        var data = "username="+vm.username+"&password="+vm.password;
                        $.ajax({
                            type: "POST",
                            url: "user/logout",
                            dataType: "json",
                            success: function(result){
                                if(result.code == 0){
                                    self.$Notice.warning({
                                        title: '友情提醒',
                                        desc: '退出成功！'
                                    });
                                    parent.location.href ='/';

                                }else{
                                    self.$Notice.warning({
                                        title: '友情提醒',
                                        desc: '退出登陆失败！'
                                    });
                                }
                            }
                        });
                    },
                    chipList:function (rootPathParam) {
                        $.ajax({
                            url:"file/chipList",
                            method:"GET",
                            datat:"json",
                            data:{
                                rootPath:rootPathParam
                            },
                            success:function (response) {
                                let data = response.data;
                                if(data==undefined || data==null) return;
                                let chip = document.getElementById("chip");
                                for(let i=0;i<data.length;i++){
                                    let li = document.createElement("li");
                                    let a = document.createElement("a");
                                    let span = document.createElement("span");
                                    let ii = document.createElement("ii");
                                    a.href = "javascript:;";
                                    span.innerText = data[i].name;
                                    ii.classList.add("am-icon-star","tpl-left-nav-content-ico","am-fr","am-margin-right");
                                    a.appendChild(span);
                                    a.appendChild(ii);
                                    li.appendChild(a);
                                    li.data = data[i].name;
                                    a.data = data[i].name;
                                    span.data = data[i].name;
                                    ii.data = data[i].name;
                                    li.addEventListener("click",(e)=>{
                                        // e.target.data
                                        changeRootPath("D:/cloudFile_chip/"+e.target.data);
                                    })
                                    // li.onclick = "changeRootPath('D:/cloudFile_chip/"+data[i].name+"');"
                                    chip.appendChild(li);
                                }

                            },
                            fail:function (error) {
                                self.$Notice.warning({
                                    title: '友情提醒',
                                    desc: '拉取文件列表信息失败'
                                });
                            }
                        })
                    }

                },
                created: function(){
                    this.loadFilePath("D:\\cloudFile_other");
                    this.rootPath = "D:\\cloudFile_other";
                    this.chipList("D:/cloudFile_chip");
                    document.getElementById("back_catalog").addEventListener("click",()=>{vm.back_catalog();});
                    // window.oncontextmenu=function(e){
                    //     e.preventDefault();
                    //     alert('onclick')
                    //     var menu=document.querySelector("#menu");
                    //     menu.style.left=e.clientX+'px';
                    //     menu.style.top=e.clientY+'px';
                    // }
                    window.onclick=function(e){
                        document.querySelector('#menu').style.width=0;
                    }
                }
            });
            that_vm = vm;
        });
        function changeRootPath(path){
            // console.log(path);
            document.getElementById("fileRootPath").innerHTML = "";
            // alert(path);
            that_vm.rootPath = path;
            that_vm.loadFilePath(path);
        }
        function downloadFile(){
            let data = document.getElementById("menu").data;
            if (data.type == 0){
                layui.use('layer', function(){
                    var $ = layui.jquery, layer = layui.layer;
                    layer.msg('暂不支持目录下载', { icon: 7, time: 1000, shade: [0.6, '#000', true] });
                });
                return;
            }
            let filePath = that_vm.rootPath+getPath();
            console.log(filePath);
            // window.localtion.href = "/file/download?filename="+filePath;
            window.open("/file/download?filename="+data.name+"&filePath="+filePath);
        }
        function getPath() {
            let path = "/";
            let data = that_vm.pathData;
            for (let i=0;i<that_vm.path.length;i++){
                path+=data[that_vm.path[i]].name;
                path+="/";
                data = data[i];
            }
            return path;
        }
    </script>
</body>

</html>